# MiMind — 上线待办清单

> **维护规则**：本文件是多 Agent 协作的唯一任务来源。
> 每项任务有唯一 ID，状态标记规则见下方。
>
> | 标记 | 含义 |
> |------|------|
> | `[ ]` | 未认领 — 任何 Agent 可认领 |
> | `[🔒 <agent>]` | 已认领 — `<agent>` 正在开发（如 `cursor-1`、`codex`、`gemini`） |
> | `[✅]` | 已完成并合并 main |
> | `[⛔]` | 已取消或不再需要 |
>
> **认领流程**：修改本文件 → `git add todo.md && git commit -m "claim: T-xxx by <agent>" && git push`
> **完成流程**：改为 `[✅]` → commit + push（随功能代码一起）

---

## 一、前端用户端 — 生产化完善

### 1.1 用户认证 & Onboarding

- [✅] **T-101** 用户端真实密码注册/登录流程（后端新增 `/api/auth/login` + JWT/session）
- [✅] **T-102** Onboarding 引导流程：注册后引导填写基础量表（PHQ-9、GAD-7），完成分流
- [✅] **T-103** 隐私政策页 `/privacy` + 服务条款页 `/terms`（中英文）
- [✅] **T-104** 忘记密码 / 重置密码流程

### 1.2 页面体验增强

- [✅] **T-111** 全局 Toast 通知组件（替代 alert，成功/错误/警告三种）
- [✅] **T-112** 全局 ErrorBoundary 组件 + 友好的错误页面（500/网络错误）
- [✅] **T-113** 404 页面（温馨风格，引导回首页）
- [✅] **T-114** 页面切换过渡动画全局统一（Framer Motion AnimatePresence）
- [✅] **T-115** 表单统一校验反馈（邮箱格式、必填、长度限制等）
- [✅] **T-116** 骨架屏 Skeleton 组件（替代纯 spinner，用于列表/卡片加载）

### 1.3 AI 教练增强

- [✅] **T-125** AI Coach 门控：移除强制 onboarding，仅在进入教练且无/过期评估时提醒，区分必做/选做量表
- [✅] **T-121** 补全 5 种咨询风格（深度探索、正念引导、行动教练 — 目前仅 2 种）
- [✅] **T-122** 教练对话打字机效果（逐字显示，模拟 Streaming）
- [✅] **T-123** 会话历史列表页（查看过往对话摘要）
- [✅] **T-124** 教练页面响应式优化（移动端键盘弹出时输入框自适应）

### 1.4 量表 & 测试增强

- [✅] **T-131** 量表结果 paywall 门控（未订阅用户模糊显示结果 + 订阅引导）
- [✅] **T-132** SCL-90 长量表分页答题 UX 优化（进度保存 + 分组标题）
- [✅] **T-133** 测试配对/互测功能（生成邀请链接 → 好友完成 → 匹配报告）
- [✅] **T-134** 量表定期重测提醒逻辑（对接后端 reassessment schedule）

### 1.5 疗愈工具增强

- [✅] **T-141** 白噪音真实音频文件集成（至少 5 种：雨声、森林、海浪、篝火、咖啡厅）
- [✅] **T-142** 冥想引导音频文件集成（至少 3 段引导音频）
- [✅] **T-143** 呼吸练习增加更多模式（box breathing 4-4-4-4、放松呼吸 5-5）
- [✅] **T-144** 工具使用统计面板（本周使用次数、累计时长）
- [✅] **T-145** 白噪音混音器升级：支持多选叠加播放 + 分轨独立音量调节 + 引导文案

### 1.6 社交 & 增长

- [✅] **T-151** 分享卡片适配多种测试类型（MBTI 特定设计、Big Five 雷达图风格）
- [✅] **T-152** Open Graph / Twitter Card 元数据（分享链接预览）
- [✅] **T-153** PWA manifest + Service Worker（离线缓存危机热线 + 安装到桌面）

### 1.7 无障碍 & 国际化

- [✅] **T-161** ARIA 无障碍审查（所有交互元素标注 role/label，键盘导航）
- [✅] **T-162** 暗色模式（CSS 变量切换 + 用户偏好持久化）
- [✅] **T-163** 语言切换后动态更新 `<html lang>`、`document.title`

---

## 二、后端 — 生产化加固

### 2.1 用户认证

- [✅] **T-201** 用户端 JWT 认证体系（注册/登录/刷新 token，独立于 admin session）
- [✅] **T-202** 邮箱验证流程（注册后发送验证链接）
- [✅] **T-203** API 速率限制（per-user / per-IP，防滥用）

### 2.2 支付集成

- [✅] **T-211** Stripe 支付集成（checkout session → webhook → 订阅激活）
- [✅] **T-212** 支付宝/微信支付集成（国内用户）
- [✅] **T-213** 订阅到期自动降级逻辑 + 续费提醒

### 2.3 数据 & 安全

- [✅] **T-221** 数据库迁移工具集成（Alembic / 自定义 migration）
- [✅] **T-222** API 请求/响应日志（脱敏后存储，用于审计）
- [✅] **T-223** 敏感数据字段加密存储（量表结果、对话记录 AES-256）

### 2.4 AI 教练后端

- [✅] **T-231** 补全 3 种咨询风格 Prompt Pack（深度探索、正念引导、行动教练）
- [✅] **T-232** 教练会话历史 API（列表 + 单条摘要）
- [✅] **T-233** OpenAI/Claude streaming 响应支持（SSE endpoint）

### 2.5 工具资源

- [✅] **T-241** 白噪音音频文件托管方案（对象存储 / CDN / 内嵌）
- [✅] **T-242** 冥想引导音频托管 + 元数据 API

---

## 三、测试 — 上线门槛

- [✅] **T-301** 前端用户端单元测试（Vitest — 至少覆盖 stores、api client、utils）
- [✅] **T-302** 前端组件测试（React Testing Library — 核心组件 Button/Card/Modal/CrisisBanner）
- [✅] **T-303** 前端 E2E 冒烟测试（Playwright — 注册→量表→结果→教练完整流程）
- [✅] **T-304** 后端安全测试补充（安全红线全覆盖回归测试）
- [✅] **T-305** 性能基准测试（首屏加载 <2s、教练响应 <3s、量表提交 <1s）

---

## 四、DevOps & 部署

- [✅] **T-401** Dockerfile（后端 + 前端构建 + Nginx 静态服务）
- [✅] **T-402** docker-compose.yml（一键启动全栈：backend + frontend + db）
- [✅] **T-403** CI pipeline（GitHub Actions：lint → test → build → deploy）
- [✅] **T-404** 环境变量文档（`.env.example` + 说明所有必需变量）
- [✅] **T-405** 生产部署指南文档（`docs/deployment.md`）

---

## 五、Admin 管理端增强

- [✅] **T-501** Admin Observability 面板 UI（模型调用统计、延迟分布、错误率）
- [✅] **T-502** Admin Prompt 管理面板 UI（查看/切换 Prompt Pack）
- [✅] **T-503** Admin 用户管理面板（用户列表、通道状态、手动分流调整）
- [✅] **T-504** Admin 数据合规操作面板（触发数据导出/删除）

---

## 六、神经多样性与认知特质探索

> **Spec**: `specs/019-neurodiversity-module/spec.md`
> **策略**: 从"疾病筛查"转向"特质探索"，不触发危机通道，严守宪法红线。

### 6.1 量表体系（前端 + 后端）

- [✅] **T-601** ASRS v1.1 注意力与执行力模式量表 — 前端：题目定义、本地计分、答题 UI + 雷达图报告（后端待对接）
- [✅] **T-602** AQ-10 社交与信息处理风格量表 — 前端：题目定义、本地计分、答题 UI + 五维度雷达图报告（后端待对接）
- [✅] **T-603** HSP 高敏感特质量表（12 核心题）— 前端：题目定义、本地计分、答题 UI + 四维度报告 + 策略建议（后端待对接）
- [✅] **T-604** CAT-Q 社交面具评估量表（25 题）— 前端：题目定义、本地计分、答题 UI + 三维度雷达图报告（后端待对接）

### 6.2 免责声明 & 合规

- [✅] **T-611** 神经多样性免责声明组件 — 测试开始前弹窗确认 + 报告页顶部固定提示 + AI 教练首次谱系对话插入（中英双语）
- [✅] **T-612** 量表结果页「本结果非诊断」提示条统一组件（可复用于所有神经多样性量表）

### 6.3 AI 教练适配

- [✅] **T-621** AI 教练 Context Prompt 神经多样性分支 — ADHD 高特质（分块沟通 + 行动教练 + RSD 识别）
- [✅] **T-622** AI 教练 Context Prompt 神经多样性分支 — ASD 高特质（直白结构化 + 系统化分析 + 社交脚本拆解）
- [✅] **T-623** AI 教练 Context Prompt 神经多样性分支 — HSP 高敏感（柔和节奏 + 停顿空间 + 柔和用词）
- [✅] **T-624** 分流逻辑补丁：谱系高分不触发危机通道，仅当并发 PHQ-9/GAD-7/C-SSRS 达阈值时按原有逻辑处理

### 6.4 疗愈工具扩充

- [✅] **T-631** 感官过载急救包 — 粉红噪音/棕色噪音生成（复用 Web Audio 引擎）+ 暗色呼吸动画 + 渐进式感官恢复引导
- [✅] **T-632** 多巴胺管理番茄钟 — 可视化计时器（25+5 可自定义）+ 微奖励动画 + 任务拆解输入框

### 6.5 社交裂变 & 分享卡片

- [✅] **T-641** 「你的大脑说明书」分享卡片 — 神经多样性特质可视化图卡（猎人型/系统化/感知放大器等标签）
- [✅] **T-642** 分享卡片适配社交平台尺寸（小红书 3:4、Instagram 1:1、TikTok 9:16）

### 6.6 国际化

- [✅] **T-651** 神经多样性量表中英文翻译（题目 + 报告 + 建议文案）
- [✅] **T-652** 免责声明中英文版本 + 法律团队占位审核标记

---

## 七、疗愈工具体系重构（当前最高优先）

> **目标**：将工具能力重组为「急救舱 + 心灵空间 + 全局伴随工具栏」，实现跨路由不中断体验。

### 7.0 P0 门禁（Spec Kit）

- [✅] **T-700** 创建独立 spec：`specs/020-tools-rearchitecture/`（`spec.md`、`plan.md`、`tasks.md`），并完成 `/speckit.specify -> /speckit.plan -> /speckit.tasks` 后再进入开发认领

### 7.1 执行批次 A（P0 基础状态层）

> **依赖顺序**：`T-701 -> T-704`

- [✅] **T-701** 新建 `frontend/user/src/stores/useToolStore.ts`（Zustand）：统一管理番茄钟、白噪音、右侧工具栏展开状态；固定状态契约字段 `pomodoro.remainingSec/isRunning/mode/preset`、`ambient.activeSoundIds/volumes/timerMin/isPlaying`、`ui.isRightSidebarOpen/activePanel`
- [✅] **T-704** 音频上下文持久化：基于现有 `frontend/user/src/utils/ambientAudio.ts` 抽象全局音频服务并接入 `useToolStore`，避免页面跳转导致播放中断

### 7.2 执行批次 B（P0 全局 UI 挂载）

> **依赖顺序**：`T-702 -> T-703`（依赖 `T-701/T-704`）

- [✅] **T-702** 新建 `frontend/user/src/components/FloatingToolbar/` 右侧抽屉组件：包含迷你番茄钟 + 白噪音混音器（支持雨声/咖啡馆等叠加）
- [✅] **T-703** 重构 `frontend/user/src/components/Layout/AppLayout.tsx`：将 `FloatingToolbar` 提升到 `<Outlet />` 之外，确保跨路由常驻

### 7.3 执行批次 C（P0 急救舱上线）

> **依赖顺序**：`T-705 -> T-706 -> T-707`

- [✅] **T-705** 新建 `frontend/user/src/pages/Relief/ReliefHub.tsx` + 路由 `/relief`，导航栏增加高优先级入口（急救舱）
- [✅] **T-706** 迁移 `BreathingExercise.tsx`、`SensoryRelief.tsx` 到 Relief 模块，默认首屏提供一键启动的大按钮交互
- [✅] **T-707** 急救模式 UX 强化：最少文字说明 + 防过载黑屏 + 低频粉红噪音快速入口（首屏 1 次点击即可启动）

### 7.4 执行批次 D（P1 心灵空间）

> **依赖顺序**：`T-711 -> T-712 -> T-713 -> T-714`

- [✅] **T-711** 新建 `frontend/user/src/pages/Mindfulness/MindfulnessHub.tsx` + 路由 `/mindfulness`，承接冥想与显化能力
- [✅] **T-712** 冥想音频源升级：替换 `public/audio/meditation/` 现有素材，改为前端可配置播放列表（高质量可商用音频）
- [✅] **T-713** 升级 `MeditationPlayer.tsx`：引入沉浸式动态背景（渐变/毛玻璃/星空或海浪视频）
- [✅] **T-714** 开发 `Manifestation` 工具 v1：肯定语记录 + 愿景卡片展示（配合轻柔背景音）

### 7.5 执行批次 E（P1 收口）

> **依赖顺序**：`T-715 -> T-716 -> T-717`

- [✅] **T-715** 删除旧 `ToolsHub.tsx` 及相关无效引用，完成工具路由收口（`/tools` 过渡期保留 1 个迭代，随后移除）
- [✅] **T-716** 更新 `zh-CN.json` 与 `en-US.json`：补充 `nav.rescue`、`nav.mindfulness`、`tools.rescue.*`、`tools.mindfulness.*`、`tools.manifestation.*` 等文案键值
- [✅] **T-717** 前端回归验证（验收标准）：
  - 路由切换时白噪音不中断（`/home -> /coach -> /relief`）
  - 右侧工具栏开合状态跨页面保持
  - 急救舱首屏 1 次点击可启动（呼吸或感官急救）
  - 心灵空间音频播放列表可配置、可播放、可切换
  - `zh-CN/en-US` 新键完整，无 missing key
  - 回归范围包含 `vitest`（store + 组件）与关键路由冒烟

### 7.6 默认假设（实现前锁定）

- 不新增后端接口，冥想播放列表先走前端配置文件
- 维持现有任务 ID（新增仅 `T-700`），不重编号、不拆分
- 按 `autodev` 流程执行认领：主目录仅编排，开发在 worktree 进行
- 公共接口锁定：新增路由 `/relief`、`/mindfulness`，并在 `T-715` 完成 `/tools` 路由收口

---

## 八、冥想显化内容升级与专业化增强（新需求拆解）

> **目标**：补齐冥想/显化内容成熟度，升级番茄钟可见性，扩展权威量表，并提升 AI Coach 专业答疑能力。

### 8.0 P0 门禁（Spec Kit）

- [✅] **T-801** 创建独立 spec：`specs/021-meditation-manifestation-professionalization/`（`spec.md`、`plan.md`、`tasks.md`），并明确版权、专业边界与验收口径
  - 验收标准：
    - 存在 `spec/plan/tasks` 三件套
    - `scripts/constitution-check.sh` 通过
    - 文档中明确非医疗边界与版权来源约束

### 8.1 冥想/显化内容整合（优先级最高）

> **依赖顺序**：`T-802 -> T-803 -> T-804`

- [✅] **T-802** 网络调研并建立「冥想/显化资源清单」：筛选可商用或可明确授权音频与前端交互范式（含来源链接、授权类型、替代方案）
  - 验收标准：
    - `docs/content/meditation-manifestation-sources.md` 新增并含不少于 20 条候选资源
    - 每条资源含：来源 URL、授权说明、建议用途、质量评分
    - 至少 2 套可落地方案（保守版/增强版）

- [✅] **T-803** 冥想音频资源升级：替换现有低质量素材，接入高质量播放列表（含封面、时长、主题标签、版权元数据）
  - 验收标准：
    - `frontend/user/src/config/meditationPlaylist.ts` 完整更新
    - 至少 12 条可播放音频项（覆盖减压/睡眠/专注/恢复）
    - 播放页可展示来源与版权字段，坏链率为 0（本地验证）

- [✅] **T-804** 显化与冥想板块前端整合升级：形成成熟的信息架构与体验流（入口、内容层级、引导动作、沉浸感）
  - 验收标准：
    - `/mindfulness` 首页信息结构完成重构并支持冥想/显化双入口
    - 显化页面具备「快速开始」与「深度练习」两层交互
    - 至少 1 条 Playwright 冒烟覆盖从入口到完成一次练习流程

### 8.2 工具栏与番茄钟微交互

- [✅] **T-805** 番茄钟小窗化：启动后在右侧工具栏附近显示轻量悬浮计时器（不遮挡主要内容，跨路由可见）
  - 验收标准：
    - 悬浮计时器在 `isRunning=true` 时自动出现，`stop` 后消失
    - 在 `/home -> /coach -> /relief` 路由切换中持续显示并正确倒计时
    - 支持最小化/展开交互，且移动端不遮挡关键按钮

### 8.3 量表专业化与解释文案

> **依赖顺序**：`T-806 -> T-807`

- [✅] **T-806** 权威量表扩充：新增一批高可信度心理量表（优先有公开文献与标准计分说明）
  - 验收标准：
    - 新增不少于 6 个量表定义（含来源文献、适用场景、计分逻辑）
    - 每个量表具备双语名称与免责声明文案
    - 至少 1 个新增量表具备完整前后端提交与结果链路

- [ ] **T-807** `tests` 与 `scales` 页面补充「简单语言用途说明」模块（每个测试/量表都有“做这个有什么用”说明）
  - 验收标准：
    - 测试中心与量表中心列表项均新增简述区块
    - 中英文文案齐全，无 missing key
    - 说明文案不使用诊断化表达，符合宪法红线

### 8.4 AI Coach 专业能力升级

- [ ] **T-808** AI Coach 专业答疑增强：在保持分流与安全门控前提下，支持面向心理学爱好者/从业者的学术级答疑
  - 验收标准：
    - 新增或升级专业问答 Prompt Pack（含术语解释、理论比较、边界声明）
    - 能回答至少 20 个预设专业问题（回归样例集）
    - 回答中禁止诊断/药物建议，触发风险词时仍遵循安全机制

### 8.5 回归与质量门禁

- [ ] **T-809** 全链路回归：冥想显化升级、番茄钟小窗、量表扩充与 AI 专业答疑统一验收
  - 验收标准：
    - `vitest`、关键 `playwright`、后端相关单测/契约测试全部通过
    - `scripts/constitution-check.sh` 与 `scripts/spec-status.sh` 通过
    - 产出验收记录：`docs/qa/t809-regression-report.md`

---

## 优先级参考

| 批次 | 任务 ID | 说明 |
|------|---------|------|
| **P0 新冲刺（内容成熟度）** | T-801~T-805 | 冥想显化资源升级 + 番茄钟微浮窗 |
| **P0 新冲刺（专业化）** | T-806~T-809 | 权威量表扩展 + 用途说明 + AI Coach 专业答疑 |
| **P0 当前冲刺（最高优先）** | T-700~T-707 | Spec 门禁 + 全局伴随工具栏 + 急救舱上线 |
| **P0 上线必须** | T-101, T-102, T-103, T-111, T-112, T-113, T-201, T-301, T-401, T-402 | 认证、基础体验、测试、部署 |
| **P0 安全红线** | T-203, T-221, T-223, T-304 | 安全加固 |
| **P1 体验优化** | T-114~T-116, T-121~T-124, T-131~T-134, T-141~T-145, T-161~T-163 | 打磨 UX |
| **P1 心灵空间升级** | T-711~T-714 | 冥想与显化沉浸式体验升级 |
| **P1 重构收尾** | T-715~T-717 | 清理旧模块 + i18n + 关键回归验证 |
| **P1 增长** | T-151~T-153, T-211~T-213 | 社交分享、支付 |
| **P1 神经多样性核心** | T-601, T-602, T-603, T-611, T-621~T-624 | 三大量表 + 合规 + AI 适配 |
| **P2 神经多样性进阶** | T-604, T-612, T-631, T-632, T-641, T-642, T-651, T-652 | CAT-Q + 工具 + 分享 + i18n |
| **P2 管理（当前冲刺后）** | T-503~T-504 | Admin 增强（在 `T-700~T-707` 完成后执行） |
